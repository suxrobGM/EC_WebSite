@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@inject ApplicationDbContext DbContext

<!DOCTYPE html>
<html>
<head>
    <title>@ViewData["title"]</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    @await RenderSectionAsync("Head", required: false)

    <environment include="Development">
        <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    </environment>
    <environment exclude="Development">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
              integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
              crossorigin="anonymous" />
    </environment>

    <link rel="stylesheet" href="~/css/wiki-theme.css" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-155178868-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-155178868-1');
    </script>
</head>

<body>
    <main class="wrapAll clearfix">
        <div class="sidebar d-none d-sm-block">
            <div class="logo">
                <a asp-page="/Index"><img src="~/img/ec_logo_wiki.png" alt="logo"></a>
            </div>
            <div class="navigation">
                <ul>
                    <li><a asp-page="/Wiki/Index" asp-route-slug="Economic_Crisis_Wiki">Main page</a></li>
                    @*<li><a href="#">Contents</a></li>*@
                    @*<li><a href="#">Featured content</a></li>*@
                </ul>
                <h3>Interaction</h3>
                <ul>
                    <li><a asp-page="/Contact">Help</a></li>
                    <li><a asp-page="/About">About</a></li>
                    <li><a asp-page="/Index">Portal</a></li>
                </ul>
            </div>
        </div>

        <div class="mainsection">
            <partial name="_CookieConsentPartial" />
            <div class="headerLinks navbar-light">
                <button id="toggle" class="navbar-toggler float-left d-inline d-sm-none"><span class="navbar-toggler-icon"></span></button>
                
                @if (SignInManager.IsSignedIn(User))
                {
                    <a id="username" asp-page="/User/Index" asp-route-username="@User.Identity.Name" title="Manage">
                        @{
                            var user = DbContext.Users.FirstOrDefault(i => i.UserName == User.Identity.Name);
                            <img src="@user?.ProfilePhotoPath" class="rounded-circle" style="width: 20px; height: 20px" alt="Profile Photo" />
                        }
                        @User.Identity.Name
                    </a>
                    <a class="form-inline" asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="/Index">Logout</a>
                 }
                 else
                 {
                    <span class="user">Not logged in</span>
                    <a asp-area="Identity" asp-page="/Account/Register">Create account</a>
                    <a asp-area="Identity" asp-page="/Account/Login">Log in</a>
                 }
            </div>

            @RenderBody()
        </div>
    </main>

    <environment include="Development">
        <script src="~/lib/jquery/dist/jquery.min.js"></script>
        <script src="~/lib/popper/popper.min.js"></script>
        <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    </environment>
    <environment exclude="Development">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
                integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
                crossorigin="anonymous">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
                integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
                crossorigin="anonymous">
        </script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
                integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
                crossorigin="anonymous">
        </script>
    </environment>
    <script>
        $('#toggle').click(() => {
            const sidebar = $('.sidebar');
            if (sidebar.hasClass('d-none')) {
                sidebar.removeClass('d-none');
                sidebar.addClass('d-block');
                console.log('case 1');
            }
            else if (sidebar.hasClass('d-block')) {
                sidebar.removeClass('d-block');
                sidebar.addClass('d-none');
                console.log('case 2');
            }
        });
    </script>
</body>
</html>